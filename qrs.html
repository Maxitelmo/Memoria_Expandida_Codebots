<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>CODEBOTS · Códigos QR con logo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body{
    font-family:system-ui,Segoe UI,Roboto,Ubuntu;
    background:linear-gradient(135deg,#0b1220,#0f172a);
    color:#e5e7eb;
    margin:0;
    padding:20px;
    text-align:center;
  }
  h1{margin-top:0;color:#22d3ee}
  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:25px;
    max-width:1000px;
    margin:0 auto;
  }
  .card{
    background:#0f172a;
    border:1px solid #1f2937;
    border-radius:14px;
    padding:16px;
    box-shadow:0 5px 15px rgba(0,0,0,.3);
  }
  .card h2{margin:10px 0;color:#22d3ee}
  .qr-wrap{display:flex;justify-content:center}
  .qr-wrap canvas{
    background:#fff;border-radius:10px;padding:6px;
  }
  small{
    color:#94a3b8;display:block;margin-top:6px;font-size:.8rem;word-break:break-all
  }
  .btn{
    margin-top:10px;padding:8px 12px;border-radius:10px;
    background:#22d3ee;color:#001018;text-decoration:none;font-weight:700;display:inline-block
  }
  .warn{color:#fcd34d;font-size:.9rem;margin:8px 0 0}
  footer{margin-top:30px;color:#94a3b8;font-size:.9rem}
</style>
</head>
<body>
<h1>QR de proyectos CODEBOTS (con logo)</h1>
<p>Escaneá o descargá los QR. Si el logo no carga, el QR igual se genera ✅</p>

<div class="grid" id="grid"></div>

<footer>© CODEBOTS · Villa Carlos Paz</footer>

<!-- Librería QR -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script>
const BASE = "https://maxitelmo.github.io/Memoria_Expandida_Codebots/index_story.html?objeto=";
const PROYECTOS = [
  {id:"baston", titulo:"Bastón para ciegos"},
  {id:"futbot-arquero-joystick", titulo:"FutBot Arquero"},
  {id:"steve-minecraft-saludador", titulo:"Steve saludador"}
];

// intentamos cargar el logo, pero NO frenamos si falla
const logo = new Image();
logo.src = "LOGO_CODE_transparente.png"; // debe estar en la raíz
let logoListo = false;
logo.onload = () => logoListo = true;
logo.onerror = () => console.warn("No se pudo cargar LOGO_CODE_transparente.png. Los QR se generarán sin logo.");

// util: dibujar logo centrado sobre un canvas
function superponerLogo(canvas){
  if(!logoListo) return; // si no hay logo, no hacer nada
  const ctx = canvas.getContext("2d");
  const size = Math.round(canvas.width * 0.24); // ~24% del ancho
  const x = (canvas.width - size) / 2;
  const y = (canvas.height - size) / 2;
  // fondo blanco para mejorar contraste
  ctx.fillStyle = "#fff";
  const pad = Math.round(size * 0.08);
  ctx.fillRect(x - pad, y - pad, size + pad*2, size + pad*2);
  ctx.drawImage(logo, x, y, size, size);
}

function crearTarjeta({id, titulo}){
  const url = BASE + encodeURIComponent(id);
  const grid = document.getElementById("grid");

  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `
    <h2>${titulo}</h2>
    <div class="qr-wrap"><div id="qr-${id}"></div></div>
    <small>${url}</small>
    <div><a class="btn" id="dl-${id}" href="#" download="${id}.png">Descargar PNG</a></div>
    <div class="warn" id="warn-${id}" style="display:none"></div>
  `;
  grid.appendChild(card);

  // Generar QR (canvas)
  const holder = document.getElementById(`qr-${id}`);
  const size = 240;
  QRCode.toCanvas(url, {width:size, margin:2, color:{dark:"#000", light:"#FFF"}}, (err, canvas) => {
    if(err){
      console.error(err);
      document.getElementById(`warn-${id}`).style.display = "block";
      document.getElementById(`warn-${id}`).textContent = "No se pudo generar el QR.";
      return;
    }
    holder.innerHTML = ""; // limpiar
    holder.appendChild(canvas);

    // intentar superponer el logo (si está listo, ahora mismo; si no, cuando cargue)
    if(logoListo){
      superponerLogo(canvas);
    }else{
      // reintento al cargar
      logo.addEventListener("load", () => superponerLogo(canvas), {once:true});
    }

    // preparar botón de descarga
    const dl = document.getElementById(`dl-${id}`);
    dl.addEventListener("click", (e)=>{
      e.preventDefault();
      try{
        const dataURL = canvas.toDataURL("image/png");
        dl.href = dataURL;
        dl.click(); // dispara la descarga
      }catch(err){
        console.error(err);
        const w = document.getElementById(`warn-${id}`);
        w.style.display = "block";
        w.textContent = "Tu navegador no permite descargar directamente. Hacé clic derecho → 'Guardar imagen como'.";
      }
    });
  });
}

// generar todas las tarjetas
PROYECTOS.forEach(crearTarjeta);
</script>
</body>
</html>
